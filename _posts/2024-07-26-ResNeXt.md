---
layout: single
title:  "ResNeXt"
date:   2024-07-26 21:10:54 
categories: [ml, papers]
author_profile: false
sidebar:
  nav: "ml"
---

## ResNeXt (2017.4)

### ë“±ì¥ ë°°ê²½

- CNN êµ¬ì¡°ê°€ ì ì  ë°œì „ë˜ë©° ì„±ëŠ¥ì„ ë†’ì¼ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ë°©ë²•ë“¤ì´ ë‚˜ì™”ë‹¤.
- ê¹Šì´ì— ì¤‘ì ì„ ë’€ë˜ VGGNet, Split-Transform-Merge ë°©ë²•ì„ ì œì‹œí–ˆë˜ Inception, Skip-Connectionê³¼ Bottleneck êµ¬ì¡°ë¡œ íš¨ìœ¨ê³¼ ìƒˆë¡œìš´ ì ‘ê·¼ ë°©ë²•ì„ ë‚´ë†“ì€ ResNet, ê·¸ë¦¬ê³  ê¹Šì´ê°€ ì•„ë‹ˆë¼ widthê°€ ì„±ëŠ¥ì„ ì˜¬ë¦¬ëŠ” factorë¼ëŠ” ê²ƒì„ ë°í˜€ë‚¸ WRNê¹Œì§€ ì—¬ëŸ¬ ë°©ì•ˆë“¤ì´ ë‚˜ì™”ë‹¤.
- ì´ì™€ ê°™ì´ ë°ì´í„° ê³µì •ë³´ë‹¤ëŠ” ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°ë¡œ ì„±ëŠ¥ì„ ëŒì–´ì˜¬ë¦¬ë ¤ëŠ” ì‹œë„ë“¤ì´ ë§ì´ ë‚˜ì™”ê³  í•´ë‹¹ ë…¼ë¬¸ ì €ìë“¤ë„ ìƒˆë¡œìš´ factorë¥¼ ì°¾ë‹¤ê°€ cardinalityë¼ëŠ” ìƒˆë¡œìš´ ìš”ì†Œë¥¼ ì œì•ˆí•œë‹¤.
- CardinalityëŠ” Grouped Conv. ì—ì„œ ê·¸ë£¹ì˜ ê°¯ìˆ˜ë¥¼ ì¹­í•˜ë©° ì‹¤í—˜ì„ í†µí•´ Cardinalityê°€ ì»¤ì§ˆìˆ˜ë¡ ì„±ëŠ¥ì´ í–¥ìƒëœë‹¤ëŠ” ê²ƒì„ ë°í˜€ëƒˆë‹¤.

### ë…¼ë¬¸ ì¶œì²˜

[1611.05431](https://arxiv.org/pdf/1611.05431)

### Grouped Convolution

- ResNeXt ë…¼ë¬¸ì—ì„œ ê°€ì¥ ë©”ì¸ì´ ë˜ëŠ” ìš”ì†ŒëŠ” Grouped Convolutionì´ë‹¤.
- ë³¸ë˜ Convolutionì€ ì…ë ¥ ê°’ì˜ ëª¨ë“  ì±„ë„ì„ ì‚¬ìš©í•´ì„œ Convolutionì„ ì§„í–‰í•˜ì§€ë§Œ Grouped Convolutionì€ ì±„ë„ì„ êµ¬ë¶„í™”í•˜ì—¬ ë”°ë¡œ Convolutionì„ ì§„í–‰í•œë‹¤.
- ì´í›„ Conv.ì˜ ì¶œë ¥ ê°’ì„ depth-wise concatenate í•œë‹¤.

![image 8.png](/assets/images/papers/image%208.png)

- ìœ„ì˜ ê·¸ë¦¼ì„ 2ê°œì˜ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ Grouped Conv.ë¥¼ í•œ ì˜ˆì‹œì´ë‹¤.

<aside>
ğŸ’¡

**Grouped Convolutionì˜ ì¥ì **

1. ë³‘ë ¬ ì²˜ë¦¬ì— ìœ ë¦¬í•˜ë‹¤. (ì¦‰, GPU ì‚¬ìš©ì— ìœ ë¦¬í•˜ë‹¤)
2. ê¸°ì¡´ Convolutionë³´ë‹¤ íŒŒë¼ë¯¸í„°ì˜ ìˆ˜ê°€ ì¤„ì–´ë“ ë‹¤.
3. ê° ê·¸ë£¹ì— ë†’ì€ correlationì„ ê°€ì§€ëŠ” ì±„ë„ì´ í•™ìŠµì´ ëœë‹¤.
</aside>

- ê·¸ëŸ¬ë©´ ì™œ Grouped Conv.ê°€ íŒŒë¼ë¯¸í„° ê°¯ìˆ˜ê°€ ë” ì ì–´ì§€ëŠ”ì§€ ìˆ˜ì‹ìœ¼ë¡œ ì•Œì•„ë³´ì.
    - $\text{k = kernel size} \\\text{c = input channel} \\\text{m = output channel} \\\text{g = number of groups}$
    - ê¸°ì¡´ Convolutionì´ë¼ë©´ í•„ìš”í•œ íŒŒë¼ë¯¸í„° ê°¯ìˆ˜ëŠ” $k^2cm$ì´ ë ê²ƒì´ë‹¤.
    - ë§Œì•½ Grouped Convolutionì´ë¼ë©´ input channelë„ output channelë„ ê·¸ë£¹ì˜ ìˆ˜ ë§Œí¼ ì¤„ì–´ë“¤ ê²ƒì´ë‹¤. ì¦‰, $k^2(c/g)(m/g)$ëŠ” í•œ ê·¸ë£¹ì˜ íŒŒë¼ë¯¸í„° ê°¯ìˆ˜ê³  $g$ê°œì˜ ê·¸ë£¹ì´ ì¡´ì¬í•˜ë‹ˆ ì´ íŒŒë¼ë¯¸í„° ê°¯ìˆ˜ëŠ” $(k^2cm)/g$ê°€ ëœë‹¤.
- ê·¸ëŸ¬ë©´ Grouped Convolutionì˜ ì„±ëŠ¥ì€ ì–´ë–¨ê¹Œ?
    - ë‹¹ì—°íˆ ê¸°ì¡´ Convolutionë³´ë‹¤ ì„±ëŠ¥ì´ ë‚˜ì˜ê²Œ ë‚˜ì˜¨ë‹¤.
    - ë¬¼ë¡  íŒŒë¼ë¯¸í„° ìˆ˜ê°€ ì ì€ ê²ƒë„ ìˆê² ì§€ë§Œ ë³¸ë˜ Convolution ë³´ë‹¤ ì ì€ ì–‘ì˜ ì •ë³´ (í˜¹ì€ ì±„ë„)ì„ ê°€ì§€ê³  ì—°ì‚°ì„ ì§„í–‰í•˜ê¸°ì— ê¸°ì¡´ Convolutionë³´ë‹¤ ì„±ëŠ¥ì´ ë‚˜ì˜ë‹¤.

### ì™œ Grouped Convolutionì„ ì‚¬ìš©í–ˆì„ê¹Œ?

- Grouped Convolutionì´ë¼ëŠ” ê°œë…ì´ ResNeXt ë…¼ë¬¸ì—ì„œ ì²˜ìŒ ë‚˜ì˜¨ ê°œë…ì€ ì•„ë‹ˆë‹¤.
- CNNì˜ ì‹œì´ˆë¼ê³  ë¶ˆë¦´ìˆ˜ ìˆëŠ” AlexNetì—ì„œë„ ì‚¬ìš©í•œ ì ì´ ìˆë‹¤. ë¬¼ë¡  ì´ë•ŒëŠ” ì„±ëŠ¥ ê°œì„ ì˜ ì´ìœ ë³´ë‹¨ 2ê°œì˜ GPUë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ 2ê°œì˜ ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì§„í–‰í•˜ì˜€ë‹¤.
- AlexNet ì´í›„ë¡œ ì„±ëŠ¥ë§Œ ë‚˜ë¹ ì§€ëŠ” Grouped Convolutionì„ ì‚¬ìš©í•˜ëŠ” ì‚¬ëŒë“¤ì€ ì—†ì—ˆë‹¤. í•˜ì§€ë§Œ ResNeXt ì €ìë“¤ì€ ë‹¤ë¥´ê²Œ ìƒê°í–ˆë‹¤. **Grouped Convolutionìœ¼ë¡œ ì•„ë‚€ íŒŒë¼ë¯¸í„°ë¥¼ ë‹¤ë¥¸ ê³³ì— íˆ¬ìí•˜ë©´ ì–´ë–¨ê¹Œ?**

### ì ˆì•½í•œ íŒŒë¼ë¯¸í„°ë¥¼ Bottleneck êµ¬ì¡° ì™„í™”ì— íˆ¬ìí•˜ì.

![image.png](/assets/images/papers/image%201%203.png)

- ì¢Œì¸¡ í…Œì´ë¸”ì„ ë³´ë©´ ê¸°ì¡´ ResNetê³¼ ResNeXtë¥¼ ë¹„êµí•œ í…Œì´ë¸”ì´ ë³´ì¸ë‹¤.
- ResNeXtëŠ” Grouped Convolutionì„ ì‚¬ìš©í•˜ëŠ”ë° íŒŒë¼ë¯¸í„° ê°¯ìˆ˜ê°€ ê¸°ì¡´ ResNetê³¼ í° ì°¨ì´ê°€ ì—†ë‹¤. ì™œì¼ê¹Œ?
- í•´ë‹¹ ì´ìœ ëŠ” ì±„ë„ ìˆ˜ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë‹¤.
- ê¸°ì¡´ **ResNetì—ì„œëŠ” Bottleneck êµ¬ì¡°ë¥¼ 4ë°°ìˆ˜ë¡œ ì‚¬ìš©í•˜ì˜€ë‹¤**. ë‘ë²ˆì§¸ ë¸”ë¡ì„ ë³´ë©´ 256ê°œì˜ ì±„ë„ì„ 128ê°œì˜ ì±„ë„ë¡œ ì¤„ì´ê³  3x3 ì—°ì‚°ì„ ì§„í–‰ í›„ 512ê°œì˜ ì±„ë„ë¡œ ì¦ê°€ì‹œí‚¨ **ë°˜ë©´ ResNeXtëŠ” 2ë°°ìˆ˜ì˜ Bottleneck êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤**. 256ê°œì˜ ì±„ë„ë¡œ ì¤„ì´ê³  512ê°œì˜ ì±„ë„ë¡œ ëŠ˜ë ¸ë‹¤.
- ResNetì—ì„œ ì†Œê°œëœ Bottleneck êµ¬ì¡°ëŠ” ì ˆëŒ€ ì„±ëŠ¥ ê°œì„ ì„ ìœ„í•´ ë„ì…ëœ ê²ƒì´ ì•„ë‹ˆë¼ íš¨ìœ¨ì„ ìœ„í•´ ë„ì…ì´ ë˜ì—ˆê¸°ì— ì´ì— ì˜í•œ ì •ë³´ ì†ì‹¤ì´ ë§‰ëŒ€í–ˆì„ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ResNeXtëŠ” ì´ë¥¼ ì™„í™”ì‹œì¼œ ì„±ëŠ¥ì„ ê°œì„ ì‹œì¼°ë‹¤.

<aside>
ğŸ’¡

ResNeXtëŠ” ìì‹ ë“¤ì˜ êµ¬ì¡°ê°€ ResNetë³´ë‹¤ ì„±ëŠ¥ì´ ì¢‹ì€ ê²ƒì„ ë°í˜€ë‚´ë©° **Grouped Convolutionì— ì˜í•œ ì •ë³´ ì†ì‹¤ë³´ë‹¤ Bottleneck êµ¬ì¡°ì— ì˜í•œ ì •ë³´ ì†ì‹¤ì´ ë” ë§ë‹¤ëŠ” ê²ƒ**ì„ ë°í˜”ë‹¤.

</aside>

### Cardinalityì˜ ì˜í–¥

![image.png](/assets/images/papers/image%202%202.png)

- Cardinalityë€ ìœ„ì—ì„œ ì–¸ê¸‰í•œ Grouped Convolutionì—ì„œ ì‚¬ìš©ë˜ëŠ” ê·¸ë£¹ì˜ ê°¯ìˆ˜ë¥¼ ëœ»í•œë‹¤.
- ìœ„ì˜ í…Œì´ë¸”ì€ Cardinalityê°€ ëª¨ë¸ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ìˆ˜ì¹˜í™” í•´ë³¸ ê²ƒì´ë‹¤.
- Settingì— ì íŒ ìˆ˜ì¹˜ë“¤ì€ (Cardinality) x (# of channels)ì˜ ì˜ë¯¸ë¥¼ ê°€ì§€ê³  ìˆê³  Cardinalityê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì„±ëŠ¥ì´ ê°œì„ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

### Cardinality vs. Width vs. Depth

![image.png](/assets/images/papers/image%203%202.png)

- Depth 2ë°° ì¦ê°€
    - ResNet-101ê³¼ ResNet-200ì„ ë¹„êµí•´ë³´ë©´ top-1 error ê¸°ì¤€ìœ¼ë¡œ **0.3%ì˜ ê°œì„ **ì´ ìˆì—ˆë‹¤.
- Width 2ë°° ì¦ê°€
    - ResNet-101ê³¼ ResNet-101 widerì„ ë¹„êµí•´ë³´ë©´ top-1 error ê¸°ì¤€ìœ¼ë¡œ **0.7%ì˜ ê°œì„ **ì´ ìˆì—ˆë‹¤.
- Cardinality 2ë°° ì¦ê°€
    - ResNet-101 1x64dì™€ ResNeXt-101 2x64dë¥¼ ë¹„êµí•´ë³´ë©´ top-1 error ê¸°ì¤€ìœ¼ë¡œ **1.3%ì˜ ê°œì„ **ì´ ìˆì—ˆë‹¤.

<aside>
ğŸ’¡

**Depth vs. Width vs. Cardinality**

ê°ê°ì˜ ìš”ì†Œê°€ ì—°ì‚°ëŸ‰ ê¸°ì¤€ 2ë°°ê°€ ëŠ˜ì–´ë‚œë‹¤ê³  ê°€ì •í–ˆì„ë•Œ Cardinality, Width, Depth ìˆœìœ¼ë¡œ ì„±ëŠ¥ì˜ ê°œì„ ì´ ë” ë†’ê²Œ ì¼ì–´ë‚¬ë‹¤. ì¦‰, Cardinalityê°€ ê°€ì¥ íš¨ìœ¨ì ìœ¼ë¡œ ì„±ëŠ¥ì„ ëŠ˜ë¦´ìˆ˜ìˆë‹¤ëŠ” ì‚¬ì‹¤ì´ ì¦ëª…ëœ ê²ƒì´ë‹¤.

</aside>

![image.png](/assets/images/papers/image%204%202.png)

- í•´ë‹¹ ê·¸ë˜í”„ëŠ” Cardinalityì˜ ì„±ëŠ¥ ê°œì„  ëŠ¥ë ¥ì„ ì‹œê°í™”í•˜ì—¬ ë”ìš± ì°¨ì´ë¥¼ ëŠë‚„ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

### ì½”ë“œ êµ¬í˜„

```python
class Bottleneck(nn.Module):
    expansion = 2 # í´ë˜ìŠ¤ ì†ì„±
    def __init__(self, in_channels, inner_channels, cardinality, stride = 1, projection = None):
        super().__init__()

        self.residual = nn.Sequential(nn.Conv2d(in_channels, inner_channels, 1, bias=False),
                                      nn.BatchNorm2d(inner_channels),
                                      nn.ReLU(inplace=True),
                                      nn.Conv2d(inner_channels, inner_channels, 3, stride=stride, padding=1, groups = cardinality, bias=False),
                                      nn.BatchNorm2d(inner_channels),
                                      nn.ReLU(inplace=True),
                                      nn.Conv2d(inner_channels, inner_channels * self.expansion, 1, bias=False),
                                      nn.BatchNorm2d(inner_channels * self.expansion))
        self.projection = projection
        self.relu = nn.ReLU(inplace=True)

    def forward(self, x):

        residual = self.residual(x)

        if self.projection is not None:
            shortcut = self.projection(x)
        else:
            shortcut = x

        out = self.relu(residual + shortcut)
        return out
```

- ResNeXtëŠ” íŒŒì´í† ì¹˜ì—ì„œ Conv2d ì•ˆì— Grouped Convolutionì´ ë‚´ì¥ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— êµ¬í˜„ì´ ë§¤ìš° ê°„ë‹¨í•˜ë‹¤.
- ì¼ë‹¨ ResNetê³¼ ì°¨ì´ê°€ ìˆëŠ” Bottleneck í´ë˜ìŠ¤ì˜ ì½”ë“œë§Œ ê°€ì ¸ì™€ë´¤ë‹¤.
- ë¨¼ì € Bottleneckì˜ ë°°ìˆ˜ë¥¼ 2ë¡œ ì¡°ì •ì„ í•´ì£¼ì—ˆë‹¤.
    - expansion = 2
- ì´í›„ nn.Conv2dì— groupsë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ìë™ìœ¼ë¡œ Grouped Convolutionì´ ì§„í–‰ëœë‹¤.
    
    ```python
    nn.Conv2d(inner_channels, inner_channels, 3, stride=stride, padding=1, groups = cardinality, bias=False),
    ```